# REINVENT4 Configuration - QSAR-Guided Mol2Mol Scaffold Optimization
# Generated by meta-controller for {{ arm_name }}

run_type = "staged_learning"
device = "cpu"
json_out_config = "_reinvent.json"

[parameters]
summary_csv_prefix = "{{ output_csv_prefix }}"
prior_file = "{{ prior_path }}"
agent_file = "{{ prior_path }}"
smiles_file = "seeds.smi"
use_checkpoint = false
purge_memories = false

batch_size = {{ batch_size }}
unique_sequences = true
randomize_smiles = {{ randomize_smiles | lower }}
sample_strategy = "multinomial"
distance_threshold = 100

[learning_strategy]
type = "dap"
sigma = {{ sigma }}
rate = {{ learning_rate }}

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = {{ diversity_bucket_size }}
minscore = {{ diversity_minscore }}
minsimilarity = {{ diversity_minsimilarity }}
penalty_multiplier = {{ diversity_penalty }}

[[stage]]
chkpt_file = "agent.chkpt"
termination = "simple"
max_score = {{ max_score }}
min_steps = 10
max_steps = {{ max_steps }}

[stage.scoring]
type = "custom_product"

# BRD4 QSAR Prediction - Primary objective (40% weight)
[[stage.scoring.component]]
[stage.scoring.component.ExternalProcess]

[[stage.scoring.component.ExternalProcess.endpoint]]
name = "BRD4_Activity"
weight = 2.0  # 40% of total (2.0 / 5.0)
params.executable = "/Users/mitchfrizelle/miniforge/envs/reinvent-meta/bin/python"
params.args = "{{ qsar_scorer_path }} {{ qsar_model_path }} sigmoid"

# Molecular Weight - Drug-like size (15% weight)
[[stage.scoring.component]]
[stage.scoring.component.MolecularWeight]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "MW"
weight = 0.75  # 15% of total
params.low = {{ mw_min }}
params.high = {{ mw_max }}
transform.type = "double_sigmoid"
transform.high = {{ mw_max }}
transform.low = {{ mw_min }}
transform.coef_div = 500.0
transform.coef_si = 20.0
transform.coef_se = 20.0

# LogP - Lipophilicity (15% weight)
[[stage.scoring.component]]
[stage.scoring.component.SlogP]
[[stage.scoring.component.SlogP.endpoint]]
name = "LogP"
weight = 0.75  # 15% of total
params.low = {{ logp_min }}
params.high = {{ logp_max }}
transform.type = "double_sigmoid"
transform.high = {{ logp_max }}
transform.low = {{ logp_min }}
transform.coef_div = 5.0
transform.coef_si = 2.0
transform.coef_se = 2.0

# TPSA - Permeability (10% weight)
[[stage.scoring.component]]
[stage.scoring.component.TPSA]
[[stage.scoring.component.TPSA.endpoint]]
name = "PSA"
weight = 0.5  # 10% of total
params.max = {{ tpsa_max }}
transform.type = "step"
transform.high = {{ tpsa_max }}

# HBD - Hydrogen bond donors (10% weight)
[[stage.scoring.component]]
[stage.scoring.component.HBondDonors]
[[stage.scoring.component.HBondDonors.endpoint]]
name = "HBD"
weight = 0.5  # 10% of total
params.max = {{ hbd_max }}
transform.type = "step"
transform.high = {{ hbd_max }}

# HBA - Hydrogen bond acceptors (10% weight)
[[stage.scoring.component]]
[stage.scoring.component.HBondAcceptors]
[[stage.scoring.component.HBondAcceptors.endpoint]]
name = "HBA"
weight = 0.5  # 10% of total
params.max = {{ hba_max }}
transform.type = "step"
transform.high = {{ hba_max }}
